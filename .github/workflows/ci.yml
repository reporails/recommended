name: CI

on:
  push:
    branches:
      # Release branches: run QA on every push (e.g. 0.1.0)
      - "[0-9]*.[0-9]*.[0-9]*"

jobs:
  qa:
    name: QA gate
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          path: recommended

      - uses: actions/checkout@v4
        with:
          repository: reporails/rules
          path: rules

      - name: Build test image
        run: docker build -t reporails-test rules/runtime/

      - name: Run test harness
        run: |
          docker run --rm \
            -v ${{ github.workspace }}/rules:/rules:ro \
            -v ${{ github.workspace }}/recommended:/recommended:ro \
            reporails-test --package /recommended
