rules:
  - id: RRAILS.E.0002.check.0001
    message: "No session start ritual section in instructions"
    severity: ERROR
    languages: [generic]
    patterns:
      - pattern-regex: "(?s)\\A#[\\s\\S]+"
      - pattern-not-regex: "(?i)(session\\s*start|start\\s*ritual|initialization|before\\s*you\\s*begin)"
    paths:
      include:
        - "{{main_instruction_file}}"

  - id: RRAILS.E.0002.check.0002
    message: "Session ritual does not reference backbone.yml"
    severity: WARNING
    languages: [generic]
    patterns:
      - pattern-regex: "(?si)\\A(?=[\\s\\S]*(?:session\\s*start|start\\s*ritual|initialization))[\\s\\S]+"
      - pattern-not-regex: "(?i)(backbone\\.ya?ml|\\.reporails/backbone)"
    paths:
      include:
        - "{{main_instruction_file}}"

  - id: RRAILS.E.0002.check.0003
    message: "Session ritual lacks numbered steps (1. 2. 3.)"
    severity: WARNING
    languages: [generic]
    patterns:
      - pattern-regex: "(?si)\\A(?=[\\s\\S]*(?:session\\s*start|start\\s*ritual|initialization))[\\s\\S]+"
      - pattern-not-regex: "1\\.[^\\n]+\\n[\\s\\S]*2\\.[^\\n]+\\n[\\s\\S]*3\\."
    paths:
      include:
        - "{{main_instruction_file}}"

  - id: RRAILS.E.0002.check.0004
    message: "Session ritual does not mention maps or navigation"
    severity: WARNING
    languages: [generic]
    patterns:
      - pattern-regex: "(?si)\\A(?=[\\s\\S]*(?:session\\s*start|start\\s*ritual|initialization))[\\s\\S]+"
      - pattern-not-regex: "(?i)(\\bmaps?\\b|navigation|component.*map|platform.*map)"
    paths:
      include:
        - "{{main_instruction_file}}"

  - id: RRAILS.E.0002.check.0005
    message: "Session ritual missing 'before searching' or 'read first' guidance"
    severity: WARNING
    languages: [generic]
    patterns:
      - pattern-regex: "(?si)\\A(?=[\\s\\S]*(?:session\\s*start|start\\s*ritual|initialization))[\\s\\S]+"
      - pattern-not-regex: "(?i)(before\\s*(searching|coding|you\\s*start)|read\\s*first|start\\s*by\\s*reading)"
    paths:
      include:
        - "{{main_instruction_file}}"

  - id: RRAILS.E.0002.check.0006
    message: "No context loading instructions for session start"
    severity: WARNING
    languages: [generic]
    patterns:
      - pattern-regex: "(?s)\\A#[\\s\\S]+"
      - pattern-not-regex: "(?i)(load\\s*context|context\\s*load|read.*before|understand.*first)"
    paths:
      include:
        - "{{main_instruction_file}}"
